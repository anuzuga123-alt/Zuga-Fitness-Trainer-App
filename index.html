<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zuga Fitness Trainer App</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00bfa6">
<style>
:root {
  --zuga-green: #00bfa6;
  --zuga-dark: #033d38;
  --zuga-light: #f7fffc;
  --gray: #555;
  --red: #ff8a8a;
  --white: #fff;
}
body {
  margin:0; font-family:"Poppins",sans-serif;
  background:var(--zuga-light); color:var(--gray);
}

/* Header */
header {
  display:flex; justify-content:space-between; align-items:center;
  background:linear-gradient(90deg,var(--zuga-green),#33c9af);
  color:white; padding:12px 18px; box-shadow:0 2px 8px rgba(0,0,0,0.1);
}
header img { height:42px; border-radius:10px; }
header button {
  background:white; color:var(--zuga-green);
  border:none; border-radius:20px; padding:6px 14px; cursor:pointer;
}

/* General Layouts */
.page { display:none; justify-content:center; align-items:center; height:100vh; }
.active { display:flex; }
.card {
  background:white; padding:25px; border-radius:16px; box-shadow:0 5px 25px rgba(0,0,0,0.1);
  width:90%; max-width:380px; text-align:center;
}
.card h2 { color:var(--zuga-green); margin-bottom:18px; }
input, textarea, select {
  width:100%; padding:10px; border-radius:10px; border:1px solid #ccc; margin-bottom:12px;
}
button {
  background:var(--zuga-green); color:white; border:none; border-radius:10px;
  padding:10px 16px; font-weight:bold; cursor:pointer;
}
button:hover { background:#01947e; }

/* Client list */
#home { padding:20px; display:none; }
.client-card {
  background:white; padding:15px; border-radius:12px;
  margin-bottom:10px; box-shadow:0 2px 6px rgba(0,0,0,0.05);
  display:flex; justify-content:space-between; align-items:center; cursor:pointer;
}
.client-card:hover { background:#eafff8; }

/* Modal */
#clientModal {
  position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.4);
  display:none; justify-content:center; align-items:center;
}
.modal-box {
  background:white; padding:20px; border-radius:15px; width:90%; max-width:400px;
}
.install-btn {
  position:fixed; bottom:15px; right:15px; background:var(--zuga-green);
  color:white; border:none; border-radius:10px; padding:10px 16px; cursor:pointer;
  display:none;
}
</style>
</head>
<body>

<header id="mainHeader" style="display:none;">
  <div style="display:flex;align-items:center;gap:10px;">
    <img src="https://zugafitness.in/wp-content/uploads/2023/07/logo.png">
    <strong>Zuga Fitness Trainer Panel</strong>
  </div>
  <button onclick="logout()">Logout</button>
</header>

<!-- LOGIN PAGE -->
<div id="login" class="page active">
  <div class="card">
    <img src="https://zugafitness.in/wp-content/uploads/2023/07/logo.png" height="60">
    <h2>Trainer Login</h2>
    <input id="loginEmail" type="text" placeholder="Email / Phone">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p style="font-size:0.9em;margin-top:10px;">New Trainer? <a href="#" onclick="showPage('register')">Register</a></p>
  </div>
</div>

<!-- REGISTER PAGE -->
<div id="register" class="page">
  <div class="card">
    <h2>Trainer Registration</h2>
    <input id="regEmail" type="text" placeholder="Email or Phone">
    <input id="regPass" type="password" placeholder="Create Password">
    <button onclick="sendOTP()">Send OTP</button>
    <input id="otpInput" type="text" placeholder="Enter OTP" style="display:none;">
    <button id="verifyBtn" onclick="verifyOTP()" style="display:none;">Verify & Register</button>
    <p style="font-size:0.9em;margin-top:10px;">Already registered? <a href="#" onclick="showPage('login')">Login</a></p>
  </div>
</div>

<!-- HOME PAGE -->
<div id="home">
  <h2 style="color:var(--zuga-green);">My Clients</h2>
  <div id="clientsList"></div>
  <button onclick="openClientModal()">‚ûï Add Client</button>
</div>

<!-- CLIENT MODAL -->
<div id="clientModal">
  <div class="modal-box">
    <h3 id="modalTitle">Add Client</h3>
    <input id="cName" placeholder="Client Name">
    <input id="cAge" placeholder="Age">
    <input id="cHeight" placeholder="Height (cm)">
    <input id="cWeight" placeholder="Weight (kg)">
    <input id="cMedical" placeholder="Medical Condition">
    <input id="cInjury" placeholder="Injury Info">
    <input id="cJoin" type="date" placeholder="Joining Date">
    <input id="cRenew" type="date" placeholder="Renewal Date">
    <textarea id="cNotes" placeholder="Goal or Notes"></textarea>
    <button onclick="saveClient()">Save</button>
    <button onclick="closeClientModal()" style="background:var(--red);margin-top:5px;">Cancel</button>
  </div>
</div>

<!-- Install App Button -->
<button class="install-btn" id="installBtn">Install Zuga Trainer App</button>

<script>
// ---- Page Navigation ----
function showPage(id){
  document.querySelectorAll('.page, #home, #clientPage').forEach(p=>p.style.display='none');
  if(document.getElementById(id)) document.getElementById(id).style.display='flex';
}

// ---- Registration ----
function sendOTP(){
  const email=document.getElementById('regEmail').value;
  if(!email){alert("Enter email or phone");return;}
  const otp=Math.floor(100000+Math.random()*900000);
  localStorage.setItem('otp',otp);
  alert("OTP sent: "+otp+" (simulated)");
  document.getElementById('otpInput').style.display='block';
  document.getElementById('verifyBtn').style.display='block';
}
function verifyOTP(){
  const entered=document.getElementById('otpInput').value;
  const actual=localStorage.getItem('otp');
  if(entered===actual){
    const email=document.getElementById('regEmail').value;
    const pass=document.getElementById('regPass').value;
    let trainers=JSON.parse(localStorage.getItem('trainers')||'{}');
    trainers[email]={password:pass,clients:[]};
    localStorage.setItem('trainers',JSON.stringify(trainers));
    alert("Registration successful!");
    showPage('login');
  }else alert("Invalid OTP");
}

// ---- Login ----
let currentTrainer=null;
function login(){
  const email=document.getElementById('loginEmail').value;
  const pass=document.getElementById('loginPass').value;
  let trainers=JSON.parse(localStorage.getItem('trainers')||'{}');
  if(trainers[email] && trainers[email].password===pass){
    currentTrainer=email;
    localStorage.setItem('loggedTrainer',email);
    openDashboard();
  }else alert("Invalid credentials");
}
function openDashboard(){
  document.getElementById('login').style.display='none';
  document.getElementById('register').style.display='none';
  document.getElementById('mainHeader').style.display='flex';
  document.getElementById('home').style.display='block';
  loadClients();
}
function logout(){
  currentTrainer=null;
  localStorage.removeItem('loggedTrainer');
  location.reload();
}

// ---- Clients ----
function loadClients(){
  const list=document.getElementById('clientsList');
  list.innerHTML='';
  const trainers=JSON.parse(localStorage.getItem('trainers')||'{}');
  const t=trainers[currentTrainer];
  if(t && t.clients.length){
    t.clients.forEach((c,i)=>{
      const div=document.createElement('div');
      div.className='client-card';
      div.innerHTML=`<span onclick="openClientPage(${i})">${c.name}</span>
      <span><button onclick="editClient(${i})">‚úèÔ∏è</button>
      <button onclick="deleteClient(${i})">üóëÔ∏è</button></span>`;
      list.appendChild(div);
    });
  } else list.innerHTML='<p>No clients yet.</p>';
}
function openClientModal(){
  document.getElementById('clientModal').style.display='flex';
  document.querySelectorAll('#clientModal input, #clientModal textarea').forEach(i=>i.value='');
  document.getElementById('clientModal').dataset.editIndex='';
}
function closeClientModal(){
  document.getElementById('clientModal').style.display='none';
}
function saveClient(){
  const client={
    name:cName.value,age:cAge.value,height:cHeight.value,weight:cWeight.value,
    medical:cMedical.value,injury:cInjury.value,join:cJoin.value,renew:cRenew.value,notes:cNotes.value,
    attendance:{},attendanceNotes:{}
  };
  let trainers=JSON.parse(localStorage.getItem('trainers')||'{}');
  const idx=document.getElementById('clientModal').dataset.editIndex;
  if(idx==='') trainers[currentTrainer].clients.push(client);
  else trainers[currentTrainer].clients[idx]=client;
  localStorage.setItem('trainers',JSON.stringify(trainers));
  closeClientModal(); loadClients();
}
function editClient(i){
  const trainers=JSON.parse(localStorage.getItem('trainers'));
  const c=trainers[currentTrainer].clients[i];
  openClientModal();
  cName.value=c.name;cAge.value=c.age;cHeight.value=c.height;cWeight.value=c.weight;
  cMedical.value=c.medical;cInjury.value=c.injury;cJoin.value=c.join;cRenew.value=c.renew;cNotes.value=c.notes;
  document.getElementById('clientModal').dataset.editIndex=i;
}
function deleteClient(i){
  if(confirm("Delete this client?")){
    let trainers=JSON.parse(localStorage.getItem('trainers'));
    trainers[currentTrainer].clients.splice(i,1);
    localStorage.setItem('trainers',JSON.stringify(trainers));
    loadClients();
  }
}

// ---- Client Page ----
function openClientPage(i){
  const trainers=JSON.parse(localStorage.getItem('trainers'));
  const client=trainers[currentTrainer].clients[i];
  localStorage.setItem('currentClientIndex',i);
  document.getElementById('home').style.display='none';
  buildClientPage(client);
}
function buildClientPage(client){
  let page=document.getElementById('clientPage');
  if(!page){
    page=document.createElement('div');
    page.id='clientPage';
    page.style.padding='20px';
    document.body.appendChild(page);
  }
  page.innerHTML=`
    <button onclick="backToHome()" style="margin-bottom:10px;">‚¨Ö Back</button>
    <h2 style="color:#00bfa6;">${client.name}</h2>
    <div style="display:flex;gap:15px;flex-wrap:wrap;">
      <div style="flex:1;min-width:230px;background:white;padding:15px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.05);">
        <h3>Client Info</h3>
        <p><b>Age:</b> ${client.age||'-'}</p>
        <p><b>Height:</b> ${client.height||'-'} cm</p>
        <p><b>Weight:</b> ${client.weight||'-'} kg</p>
        <p><b>Medical:</b> ${client.medical||'-'}</p>
        <p><b>Injury:</b> ${client.injury||'-'}</p>
        <p><b>Joined:</b> ${client.join||'-'}</p>
        <p><b>Renewal:</b> ${client.renew||'-'}</p>
      </div>
      <div style="flex:2;min-width:300px;background:white;padding:15px;border-radius:12px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.05);">
        <h3>Attendance Calendar</h3>
        <div id="calendarGrid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:6px;"></div>
        <button style="margin-top:10px;" onclick="downloadReport()">üì§ Download Monthly Report</button>
      </div>
      <div style="flex:1;min-width:230px;background:white;padding:15px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.05);">
        <h3>Day Info</h3>
        <p><b>Date:</b> <span id="selectedDate">-</span></p>
        <label>Attendance:</label>
        <select id="dayStatus">
          <option value="">Select</option>
          <option value="present">‚úÖ Present</option>
          <option value="absent">‚ùå Absent</option>
          <option value="holiday">üèñÔ∏è Holiday</option>
          <option value="freeze">‚ùÑÔ∏è Freeze</option>
        </select>
        <textarea id="dayNote" placeholder="Practices done today..." style="width:100%;height:80px;margin-top:8px;"></textarea>
        <button onclick="saveDayInfo()">Save</button>
      </div>
    </div>
  `;
  buildCalendar(client);
  page.style.display='block';
}
function buildCalendar(client){
  const calendar=document.getElementById('calendarGrid');
  calendar.innerHTML='';
  const today=new Date();
  const year=today.getFullYear(), month=today.getMonth();
  const daysInMonth=new Date(year,month+1,0).getDate();
  for(let d=1;d<=daysInMonth;d++){
    const date=`${year}-${month+1}-${d}`;
    const status=(client.attendance||{})[date];
    let color='white';
    if(status==='present') color='#a7f3d0';
    else if(status==='absent') color='#fecaca';
    else if(status==='holiday') color='#fef9c3';
    else if(status==='freeze') color='#e0e7ff';
    const day=document.createElement('div');
    day.textContent=d;
    day.style.borderRadius='50%'; day.style.padding='8px'; day.style.cursor='pointer'; day.style.background=color;
    day.onclick=()=>selectDay(client,date);
    calendar.appendChild(day);
  }
}
function selectDay(client,date){
  document.getElementById('selectedDate').innerText=date;
  document.getElementById('dayStatus').value=client.attendance?.[date]||'';
  document.getElementById('dayNote').value=client.attendanceNotes?.[date]||'';
}
function saveDayInfo(){
  const date=document.getElementById('selectedDate').innerText;
  if(!date||date==='-'){alert("Select a date first.");return;}
  const status=document.getElementById('dayStatus').value;
  const note=document.getElementById('dayNote').value;
  const idx=localStorage.getItem('currentClientIndex');
  let trainers=JSON.parse(localStorage.getItem('trainers'));
  const c=trainers[currentTrainer].clients[idx];
  c.attendance[cdate]=status;
  c.attendanceNotes[date]=note;
  localStorage.setItem('trainers',JSON.stringify(trainers));
  buildClientPage(c);
}
function downloadReport(){ alert("Monthly progress report downloading... (feature coming soon)"); }
function backToHome(){ document.getElementById('clientPage').style.display='none'; document.getElementById('home').style.display='block'; }

// ---- Auto-login ----
window.onload=()=>{ const saved=localStorage.getItem('loggedTrainer'); if(saved){currentTrainer=saved;openDashboard();} };

// ---- PWA ----
let deferredPrompt;
const installBtn=document.getElementById('installBtn');
window.addEventListener('beforeinstallprompt', e=>{ e.preventDefault(); deferredPrompt=e; installBtn.style.display='block'; });
installBtn.addEventListener('click', async ()=>{ installBtn.style.display='none'; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; });
if('serviceWorker' in navigator){ window.addEventListener('load', ()=>{ navigator.serviceWorker.register('service-worker.js').then(()=>console.log('‚úÖ Service worker registered')); }); }
</script>

</body>
</html>
