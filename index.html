<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zuga Fitness Trainer App</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00bfa6">

<style>
:root {
  --zuga-green: #00bfa6;
  --zuga-dark: #033d38;
  --zuga-light: #f7fffc;
  --gray: #555;
  --red: #ff8a8a;
  --white: #fff;
}
body {
  margin:0; font-family:"Poppins",sans-serif;
  background:var(--zuga-light); color:var(--gray);
}
header {
  display:flex; justify-content:space-between; align-items:center;
  background:linear-gradient(90deg,var(--zuga-green),#33c9af);
  color:white; padding:12px 18px; box-shadow:0 2px 8px rgba(0,0,0,0.1);
}
header img { height:40px; border-radius:8px; }
header button {
  background:white; color:var(--zuga-green); border:none;
  border-radius:20px; padding:6px 14px; cursor:pointer;
}
.page { display:none; justify-content:center; align-items:center; height:100vh; }
.active { display:flex; }
.card {
  background:white; padding:25px; border-radius:16px;
  box-shadow:0 5px 25px rgba(0,0,0,0.1); width:90%; max-width:380px; text-align:center;
}
.card h2 { color:var(--zuga-green); margin-bottom:18px; }
input, textarea, select {
  width:100%; padding:10px; border-radius:10px; border:1px solid #ccc; margin-bottom:12px;
}
button {
  background:var(--zuga-green); color:white; border:none; border-radius:10px;
  padding:10px 16px; font-weight:bold; cursor:pointer;
}
button:hover { background:#01947e; }
#home { padding:20px; display:none; }
.client-card {
  background:white; padding:15px; border-radius:12px; margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
  display:flex; justify-content:space-between; align-items:center; cursor:pointer;
}
.client-card:hover { background:#eafff8; }
#clientModal {
  position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.4);
  display:none; justify-content:center; align-items:center;
}
.modal-box {
  background:white; padding:20px; border-radius:15px; width:90%; max-width:400px;
}
.install-btn {
  position:fixed; bottom:15px; right:15px; background:var(--zuga-green);
  color:white; border:none; border-radius:10px; padding:10px 16px; cursor:pointer;
  display:none;
}
</style>
</head>
<body>

<header id="mainHeader" style="display:none;">
  <div style="display:flex;align-items:center;gap:10px;">
    <img src="https://zugafitness.in/wp-content/uploads/2023/07/logo.png">
    <strong>Zuga Trainer Panel</strong>
  </div>
  <button onclick="logout()">Logout</button>
</header>

<!-- LOGIN PAGE -->
<div id="login" class="page active">
  <div class="card">
    <img src="https://zugafitness.in/wp-content/uploads/2023/07/logo.png" height="60">
    <h2>Trainer Login</h2>
    <input id="loginEmail" type="text" placeholder="Email / Phone">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p style="font-size:0.9em;margin-top:10px;">New Trainer? <a href="#" onclick="showPage('register')">Register</a></p>
  </div>
</div>

<!-- REGISTER PAGE -->
<div id="register" class="page">
  <div class="card">
    <h2>Trainer Registration</h2>
    <input id="regEmail" type="text" placeholder="Email or Phone">
    <input id="regPass" type="password" placeholder="Create Password">
    <button onclick="sendOTP()">Send OTP</button>
    <input id="otpInput" type="text" placeholder="Enter OTP" style="display:none;">
    <button id="verifyBtn" onclick="verifyOTP()" style="display:none;">Verify & Register</button>
    <p style="font-size:0.9em;margin-top:10px;">Already registered? <a href="#" onclick="showPage('login')">Login</a></p>
  </div>
</div>

<!-- HOME PAGE -->
<div id="home">
  <h2 style="color:var(--zuga-green);">My Clients</h2>
  <div id="clientsList"></div>
  <button onclick="openClientModal()">‚ûï Add Client</button>
</div>

<!-- CLIENT MODAL -->
<div id="clientModal">
  <div class="modal-box">
    <h3 id="modalTitle">Add Client</h3>
    <input id="cName" placeholder="Client Name">
    <input id="cAge" placeholder="Age">
    <input id="cHeight" placeholder="Height (cm)">
    <input id="cWeight" placeholder="Weight (kg)">
    <input id="cMedical" placeholder="Medical Condition">
    <input id="cInjury" placeholder="Injury Info">
    <input id="cJoin" type="date" placeholder="Joining Date">
    <input id="cRenew" type="date" placeholder="Renewal Date">
    <textarea id="cNotes" placeholder="Goal or Notes"></textarea>
    <button onclick="saveClient()">Save</button>
    <button onclick="closeClientModal()" style="background:var(--red);margin-top:5px;">Cancel</button>
  </div>
</div>

<!-- Install App Button -->
<button class="install-btn" id="installBtn">Install Zuga Trainer App</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* ======= PAGE NAVIGATION ======= */
function showPage(id){
  document.querySelectorAll('.page, #home, #clientPage').forEach(p=>p.style.display='none');
  if(document.getElementById(id)) document.getElementById(id).style.display='flex';
}

/* ======= REGISTRATION ======= */
function sendOTP(){
  const email=document.getElementById('regEmail').value;
  if(!email){alert("Enter email or phone");return;}
  const otp=Math.floor(100000+Math.random()*900000);
  localStorage.setItem('otp',otp);
  alert("OTP sent: "+otp+" (simulated)");
  document.getElementById('otpInput').style.display='block';
  document.getElementById('verifyBtn').style.display='block';
}
function verifyOTP(){
  const entered=document.getElementById('otpInput').value;
  const actual=localStorage.getItem('otp');
  if(entered===actual){
    const email=document.getElementById('regEmail').value;
    const pass=document.getElementById('regPass').value;
    let trainers=JSON.parse(localStorage.getItem('trainers')||'{}');
    trainers[email]={password:pass,clients:[]};
    localStorage.setItem('trainers',JSON.stringify(trainers));
    alert("Registration successful!");
    showPage('login');
  }else alert("Invalid OTP");
}

/* ======= LOGIN ======= */
let currentTrainer=null;
function login(){
  const email=document.getElementById('loginEmail').value;
  const pass=document.getElementById('loginPass').value;
  let trainers=JSON.parse(localStorage.getItem('trainers')||'{}');
  if(trainers[email] && trainers[email].password===pass){
    currentTrainer=email;
    localStorage.setItem('loggedTrainer',email);
    openDashboard();
  }else alert("Invalid credentials");
}
function openDashboard(){
  document.getElementById('login').style.display='none';
  document.getElementById('register').style.display='none';
  document.getElementById('mainHeader').style.display='flex';
  document.getElementById('home').style.display='block';
  loadClients();
}
function logout(){
  currentTrainer=null;
  localStorage.removeItem('loggedTrainer');
  location.reload();
}

/* ======= CLIENT MANAGEMENT ======= */
function loadClients(){
  const list=document.getElementById('clientsList');
  list.innerHTML='';
  const trainers=JSON.parse(localStorage.getItem('trainers')||'{}');
  const t=trainers[currentTrainer];
  if(t && t.clients.length){
    t.clients.forEach((c,i)=>{
      const div=document.createElement('div');
      div.className='client-card';
      div.innerHTML=`<span onclick="openClientPage(${i})">${c.name}</span>
      <span><button onclick="editClient(${i})">‚úèÔ∏è</button>
      <button onclick="deleteClient(${i})">üóëÔ∏è</button></span>`;
      list.appendChild(div);
    });
  } else list.innerHTML='<p>No clients yet.</p>';
}
function openClientModal(){
  document.getElementById('clientModal').style.display='flex';
  document.querySelectorAll('#clientModal input, #clientModal textarea').forEach(i=>i.value='');
  document.getElementById('clientModal').dataset.editIndex='';
}
function closeClientModal(){
  document.getElementById('clientModal').style.display='none';
}
function saveClient(){
  const client={
    name:cName.value,age:cAge.value,height:cHeight.value,weight:cWeight.value,
    medical:cMedical.value,injury:cInjury.value,join:cJoin.value,renew:cRenew.value,notes:cNotes.value,
    attendance:{},attendanceNotes:{}
  };
  let trainers=JSON.parse(localStorage.getItem('trainers')||'{}');
  const idx=document.getElementById('clientModal').dataset.editIndex;
  if(idx==='') trainers[currentTrainer].clients.push(client);
  else trainers[currentTrainer].clients[idx]=client;
  localStorage.setItem('trainers',JSON.stringify(trainers));
  closeClientModal(); loadClients();
}
function editClient(i){
  const trainers=JSON.parse(localStorage.getItem('trainers'));
  const c=trainers[currentTrainer].clients[i];
  openClientModal();
  cName.value=c.name;cAge.value=c.age;cHeight.value=c.height;cWeight.value=c.weight;
  cMedical.value=c.medical;cInjury.value=c.injury;cJoin.value=c.join;cRenew.value=c.renew;cNotes.value=c.notes;
  document.getElementById('clientModal').dataset.editIndex=i;
}
function deleteClient(i){
  if(confirm("Delete this client?")){
    let trainers=JSON.parse(localStorage.getItem('trainers'));
    trainers[currentTrainer].clients.splice(i,1);
    localStorage.setItem('trainers',JSON.stringify(trainers));
    loadClients();
  }
}

/* ======= CLIENT PAGE + CALENDAR ======= */
function openClientPage(i){
  const trainers=JSON.parse(localStorage.getItem('trainers'));
  const client=trainers[currentTrainer].clients[i];
  localStorage.setItem('currentClientIndex',i);
  document.getElementById('home').style.display='none';
  buildClientPage(client);
}
/* ===== CONTINUATION FROM PREVIOUS CODE ===== */

function buildClientPage(client){
  document.body.innerHTML = `
  <header>
    <div style="display:flex;align-items:center;gap:10px;">
      <img src="https://zugafitness.in/wp-content/uploads/2023/07/logo.png">
      <strong>${client.name}</strong>
    </div>
    <button onclick="backToHome()">Back</button>
  </header>

  <div style="padding:10px;display:grid;grid-template-columns:1fr 1.3fr 1fr;gap:10px;">
    <!-- LEFT: Client Info -->
    <div style="background:white;padding:10px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);">
      <h3 style="color:var(--zuga-green);text-align:center;">Client Info</h3>
      <p><b>Name:</b> ${client.name}</p>
      <p><b>Age:</b> ${client.age}</p>
      <p><b>Height:</b> ${client.height} cm</p>
      <p><b>Weight:</b> ${client.weight} kg</p>
      <p><b>Medical:</b> ${client.medical || 'None'}</p>
      <p><b>Injury:</b> ${client.injury || 'None'}</p>
      <p><b>Joined:</b> ${client.join}</p>
      <p><b>Renewal:</b> ${client.renew}</p>
      <p><b>Goal:</b> ${client.notes}</p>
    </div>

    <!-- CENTER: Calendar -->
    <div id="calendarContainer" style="background:white;padding:15px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);text-align:center;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
        <button onclick="prevMonth()">‚¨ÖÔ∏è</button>
        <h3 id="monthLabel"></h3>
        <button onclick="nextMonth()">‚û°Ô∏è</button>
      </div>
      <div id="calendarGrid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:8px;"></div>
      <button style="margin-top:10px;" onclick="downloadReport()">üì• Download Monthly Report</button>
    </div>

    <!-- RIGHT: Day Info -->
    <div id="dayInfo" style="background:white;padding:10px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);">
      <h3 style="color:var(--zuga-green);text-align:center;">Day Info</h3>
      <p id="dayLabel">Select a date</p>
      <select id="attSelect" onchange="setAttendance()">
        <option value="">Select Attendance</option>
        <option value="present">‚úÖ Present</option>
        <option value="absent">‚ùå Absent</option>
        <option value="holiday">üå¥ Holiday</option>
        <option value="freeze">üßä Freeze</option>
      </select>
      <textarea id="notesBox" placeholder="What practice today?" onblur="saveNotes()"></textarea>
    </div>
  </div>
  `;

  currentMonth = new Date().getMonth();
  currentYear = new Date().getFullYear();
  renderCalendar(client);
}

let currentMonth, currentYear;
function renderCalendar(client){
  const grid = document.getElementById('calendarGrid');
  const monthLabel = document.getElementById('monthLabel');
  const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  const daysInMonth = new Date(currentYear, currentMonth+1, 0).getDate();
  const firstDay = new Date(currentYear, currentMonth, 1).getDay();
  grid.innerHTML='';
  monthLabel.textContent = monthNames[currentMonth] + ' ' + currentYear;

  for(let i=0;i<firstDay;i++) grid.appendChild(document.createElement('div'));

  const trainers = JSON.parse(localStorage.getItem('trainers'));
  const idx = localStorage.getItem('currentClientIndex');
  const c = trainers[currentTrainer].clients[idx];

  for(let d=1; d<=daysInMonth; d++){
    const btn = document.createElement('button');
    btn.textContent = d;
    btn.style.border='none';
    btn.style.borderRadius='50%';
    btn.style.width='35px';
    btn.style.height='35px';
    btn.style.cursor='pointer';
    btn.style.fontWeight='bold';
    btn.style.background='white';
    const key = `${currentYear}-${currentMonth+1}-${d}`;
    const status = c.attendance[key];
    if(status==='present') btn.style.background='#c8ffd4';
    else if(status==='absent') btn.style.background='#ffd3d3';
    else if(status==='holiday') btn.style.background='#fff8c2';
    else if(status==='freeze') btn.style.background='#bde0fe';
    btn.onclick = ()=>selectDate(d);
    grid.appendChild(btn);
  }
}

function prevMonth(){ currentMonth--; if(currentMonth<0){currentMonth=11;currentYear--;} reloadCalendar(); }
function nextMonth(){ currentMonth++; if(currentMonth>11){currentMonth=0;currentYear++;} reloadCalendar(); }
function reloadCalendar(){
  const trainers=JSON.parse(localStorage.getItem('trainers'));
  const idx=localStorage.getItem('currentClientIndex');
  renderCalendar(trainers[currentTrainer].clients[idx]);
}

let selectedDate=null;
function selectDate(d){
  selectedDate=`${currentYear}-${currentMonth+1}-${d}`;
  const label=document.getElementById('dayLabel');
  label.textContent=`Date: ${selectedDate}`;
  const trainers=JSON.parse(localStorage.getItem('trainers'));
  const idx=localStorage.getItem('currentClientIndex');
  const c=trainers[currentTrainer].clients[idx];
  document.getElementById('attSelect').value=c.attendance[selectedDate]||'';
  document.getElementById('notesBox').value=c.attendanceNotes[selectedDate]||'';
}

function setAttendance(){
  if(!selectedDate) return alert("Select a date first");
  const val=document.getElementById('attSelect').value;
  let trainers=JSON.parse(localStorage.getItem('trainers'));
  const idx=localStorage.getItem('currentClientIndex');
  const c=trainers[currentTrainer].clients[idx];
  c.attendance[selectedDate]=val;
  localStorage.setItem('trainers',JSON.stringify(trainers));
  reloadCalendar();
}

function saveNotes(){
  if(!selectedDate) return;
  const txt=document.getElementById('notesBox').value;
  let trainers=JSON.parse(localStorage.getItem('trainers'));
  const idx=localStorage.getItem('currentClientIndex');
  const c=trainers[currentTrainer].clients[idx];
  c.attendanceNotes[selectedDate]=txt;
  localStorage.setItem('trainers',JSON.stringify(trainers));
}

/* ===== DOWNLOAD MONTHLY REPORT ===== */
async function downloadReport(){
  const trainers=JSON.parse(localStorage.getItem('trainers'));
  const idx=localStorage.getItem('currentClientIndex');
  const c=trainers[currentTrainer].clients[idx];
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text(`Zuga Fitness Monthly Report`, 20, 20);
  doc.setFontSize(12);
  doc.text(`Client: ${c.name}`, 20, 30);
  doc.text(`Month: ${currentMonth+1}-${currentYear}`, 20, 38);
  let y=50;
  Object.keys(c.attendance).forEach(date=>{
    if(date.includes(`${currentYear}-${currentMonth+1}-`)){
      doc.text(`${date} - ${c.attendance[date] || 'N/A'} - ${c.attendanceNotes[date]||''}`,20,y);
      y+=8;
      if(y>270){ doc.addPage(); y=20; }
    }
  });
  doc.save(`${c.name}_report_${currentMonth+1}_${currentYear}.pdf`);
}

/* ===== NAVIGATION ===== */
function backToHome(){ location.reload(); }

/* ===== INSTALL PWA ===== */
let deferredPrompt;
window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault(); deferredPrompt=e;
  document.getElementById('installBtn').style.display='block';
});
document.getElementById('installBtn').addEventListener('click',async()=>{
  if(deferredPrompt){
    deferredPrompt.prompt();
    const {outcome}=await deferredPrompt.userChoice;
    if(outcome==='accepted'){document.getElementById('installBtn').style.display='none';}
    deferredPrompt=null;
  }
});

/* ===== AUTO LOGIN IF SESSION ===== */
window.onload=()=>{
  const t=localStorage.getItem('loggedTrainer');
  if(t){ currentTrainer=t; openDashboard(); }
};
</script>
</body>
</html>
